import{_ as v}from"./IButton.vuevuetypescriptsetuptruelang-BmDO9Tjc.js";import{d as b,f as l,o as s,c as d,a as u,g as B,w as m,b as p,u as _,i as E,n as f,t as D,p as C}from"./index-zO2yB-9a.js";import{s as w}from"./error-oUr4zJjZ.js";const T={key:0},x={key:1},Q={key:1,class:"barcode-detection__code"},R=["href"],j=b({__name:"BarcodeDetection",setup(V){const k=l("BarcodeDetector"in window),c=l(null),t=l(!1),a=l(null),y=new Audio("./success-beep.mp3");async function g(){try{if(!window.BarcodeDetector)throw new Error("Barcode Detection API не поддерживается");const o=new window.BarcodeDetector({formats:["qr_code","ean_13","code_128","upc_a"]}),e=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});if(t.value=!0,await C(),!a.value)throw new Error("Видеоэлемент недоступен");a.value.srcObject=e,await a.value.play();const n=async()=>{try{if(!a.value||a.value.paused){e.getTracks().forEach(r=>r.stop()),t.value=!1;return}const i=await o.detect(a.value);i.length>0?(c.value=i[0].rawValue,await y.play(),e.getTracks().forEach(r=>r.stop()),t.value=!1):requestAnimationFrame(n)}catch(i){alert(`Ошибка: ${w(i)}`),e.getTracks().forEach(r=>r.stop()),t.value=!1}};requestAnimationFrame(n)}catch(o){alert(`Ошибка: ${w(o)}`),t.value=!1}}function h(){var o;(o=a.value)!=null&&o.srcObject&&a.value.srcObject.getTracks().forEach(n=>n.stop()),t.value=!1}return(o,e)=>k.value?(s(),d("div",x,[u("div",null,[B(_(v),{onClick:g,disabled:t.value},{default:m(()=>e[0]||(e[0]=[p("Сканировать QR-код")])),_:1},8,["disabled"]),t.value?(s(),E(_(v),{key:0,onClick:h},{default:m(()=>e[1]||(e[1]=[p("Закрыть")])),_:1})):f("",!0)]),t.value?(s(),d("video",{key:0,ref_key:"videoElement",ref:a,class:"detection__video"},null,512)):f("",!0),c.value?(s(),d("div",Q,[e[2]||(e[2]=u("div",null,"Обнаруженный QR-код:",-1)),u("a",{href:c.value},D(c.value),9,R)])):f("",!0)])):(s(),d("div",T,"QR-сканер не поддерживается устройством"))}});export{j as default};
