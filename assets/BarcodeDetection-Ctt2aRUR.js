import{_ as f}from"./IButton.vuevuetypescriptsetuptruelang-DCbEXGaB.js";import{d as g,g as l,c as d,o as r,a as u,n as v,h as B,j as E,w as _,b as m,i as p,t as D,p as C}from"./index-Bs-7ZeCf.js";import{s as w}from"./error-oUr4zJjZ.js";const T={key:0},x={key:1},Q={class:"barcode-detection__actions"},R={key:1,class:"barcode-detection__code"},V=["href"],q=g({__name:"BarcodeDetection",setup(j){const k=l("BarcodeDetector"in window),c=l(null),t=l(!1),a=l(null),h=new Audio("./success-beep.mp3");async function y(){try{if(!window.BarcodeDetector)throw new Error("Barcode Detection API не поддерживается");const o=new window.BarcodeDetector({formats:["qr_code","ean_13","code_128","upc_a"]}),e=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});if(t.value=!0,await C(),!a.value)throw new Error("Видеоэлемент недоступен");a.value.srcObject=e,await a.value.play();const n=async()=>{try{if(!a.value||a.value.paused){e.getTracks().forEach(s=>s.stop()),t.value=!1;return}const i=await o.detect(a.value);i.length>0?(c.value=i[0].rawValue,await h.play(),e.getTracks().forEach(s=>s.stop()),t.value=!1):requestAnimationFrame(n)}catch(i){alert(`Ошибка: ${w(i)}`),e.getTracks().forEach(s=>s.stop()),t.value=!1}};requestAnimationFrame(n)}catch(o){alert(`Ошибка: ${w(o)}`),t.value=!1}}function b(){var o;(o=a.value)!=null&&o.srcObject&&a.value.srcObject.getTracks().forEach(n=>n.stop()),t.value=!1}return(o,e)=>k.value?(r(),d("div",x,[u("div",Q,[B(p(f),{onClick:y,disabled:t.value},{default:_(()=>e[0]||(e[0]=[m("Сканировать QR-код")])),_:1,__:[0]},8,["disabled"]),t.value?(r(),E(p(f),{key:0,onClick:b},{default:_(()=>e[1]||(e[1]=[m("Закрыть")])),_:1,__:[1]})):v("",!0)]),t.value?(r(),d("video",{key:0,ref_key:"videoElement",ref:a,class:"barcode-detection__video"},null,512)):v("",!0),c.value?(r(),d("div",R,[e[2]||(e[2]=u("div",null,"Обнаруженный QR-код:",-1)),u("a",{href:c.value},D(c.value),9,V)])):v("",!0)])):(r(),d("div",T,"QR-сканер не поддерживается устройством"))}});export{q as default};
