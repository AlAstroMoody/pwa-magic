import{_}from"./IButton.vuevuetypescriptsetuptruelang-CF-pyYmf.js";import{d as h,f as n,o as c,c as i,g as y,w as g,b as k,u as C,n as m,t as B}from"./index-DQKowVkj.js";import{s as f}from"./error-oUr4zJjZ.js";const D={key:0},E={key:1},b={key:1},A=h({__name:"BarcodeDetection",setup(x){const v=n("BarcodeDetector"in window),d=n(null),t=n(!1),l=n(null),p=new Audio("/success-beep.mp3");async function w(){try{if(!window.BarcodeDetector)throw new Error("Barcode Detection API не поддерживается");const s=new window.BarcodeDetector({formats:["qr_code","ean_13","code_128","upc_a"]}),a=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}}),e=document.createElement("video");if(e.srcObject=a,await e.play(),await new Promise(r=>{e.onloadedmetadata=()=>r()}),t.value=!0,l.value)l.value.appendChild(e),e.style.width="100%",e.style.maxWidth="400px",e.style.marginTop="10px";else throw new Error("Контейнер для видео недоступен");const u=async()=>{try{if(e.paused){t.value=!1,a.getTracks().forEach(o=>o.stop()),e.remove();return}const r=await s.detect(e);r.length>0?(d.value=r[0].rawValue,await p.play().catch(o=>console.error("Ошибка воспроизведения звука:",o)),a.getTracks().forEach(o=>o.stop()),t.value=!1,e.remove()):requestAnimationFrame(u)}catch(r){alert(`Ошибка: ${f(r)}`),a.getTracks().forEach(o=>o.stop()),t.value=!1,e.remove()}};requestAnimationFrame(u)}catch(s){alert(`Ошибка: ${f(s)}`),t.value=!1}}return(s,a)=>v.value?(c(),i("div",E,[y(C(_),{onClick:w,disabled:t.value},{default:g(()=>a[0]||(a[0]=[k("Сканировать QR-код")])),_:1},8,["disabled"]),t.value?(c(),i("div",{key:0,ref_key:"videoContainer",ref:l},null,512)):m("",!0),d.value?(c(),i("div",b,"Обнаруженный QR-код: "+B(d.value),1)):m("",!0)])):(c(),i("div",D,"QR-сканер не поддерживается устройством"))}});export{A as default};
